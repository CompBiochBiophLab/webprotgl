<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <title>WebProtGL</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <style type="text/css">
#commands {
 width: 100%;
 padding-bottom: 2.5em;
}

.action {
 background-color: #AACCBB;
 cursor: pointer;
 padding: 0.4em;
 margin: 0.2em;
 float: left;
 box-shadow: 0.2em 0.2em 0.3em 0.1em #333333;
 border-radius: 0.5em;
}

.action:hover {
 box-shadow: 0.2em 0.2em 0.3em 0.1em #AAAAAA;
}

#popup {
 top: 8em;
 left: 4em;
 padding: 2em;
 position: absolute;
 background-color: #AACCBB;
 float: left;
 box-shadow: 1em 1em 1.5em 0.5em #333333;
 border-radius: 2em;
 display: none;
}
    </style>
  </head>
  <body>
    <textarea id="shader_sphere_vertex" style="display:none;">
attribute vec3 attrPosition;
attribute vec3 attrNormal;
attribute vec2 attrColour;

uniform mat4 cameraMatrix;
uniform mat4 worldMatrix;
uniform vec3 eye;
uniform mat3 inverseMatrix;
uniform float radius;
uniform vec4 colour;

varying vec3 vNormal;
varying vec4 col;
varying vec3 poseye;
varying float posdist;

void main(void) {
  vec4 intPos = worldMatrix * vec4(attrPosition * radius, 1.);
  gl_Position = cameraMatrix * intPos;
//  gl_Position = cameraMatrix * worldMatrix * vec4(attrPosition * radius, 1.);
  vNormal = attrNormal;
  col = colour;

  poseye = eye - intPos.xyz;
  posdist = dot(poseye, poseye);
  poseye = normalize(poseye);
}
    </textarea>
    <textarea id="shader_sphere_fragment" style="display:none;">
#ifdef GL_ES
  precision highp float;
#endif

varying vec3 vNormal;
varying vec4 col;
varying vec3 poseye;
varying float posdist;

void main(void) {
  // Intensity of diffuse light
  float i = dot(poseye, vNormal);
  if (i < -1e-3)
    discard;
  vec4 cc = vec4(i * col.rgb, 1.);
//  i = max(min(i, 1.), 0.);

  // Diffuse light

  gl_FragColor = cc;
}
    </textarea>
    <textarea id="shader_cylinder_vertex" style="display:none;">
attribute vec3 attrPosition;
attribute vec3 attrNormal;
attribute vec2 attrColour;

uniform mat4 cameraMatrix;
uniform mat4 worldMatrix;
uniform vec3 eye;
uniform mat3 inverseMatrix;
uniform float radius;
uniform vec4 colour;

varying vec3 vNormal;
varying vec4 col;
varying vec3 poseye;
varying float posdist;

void main(void) {
  vec4 intPos = worldMatrix * vec4(attrPosition.xy * radius, attrPosition.z, 1.);
  gl_Position = cameraMatrix * intPos;
  vNormal = attrNormal;
  col = colour;

  poseye = eye - intPos.xyz;
  posdist = dot(poseye, poseye);
  poseye = normalize(poseye);
}
    </textarea>
    <textarea id="shader_cylinder_fragment" style="display:none;">
#ifdef GL_ES
  precision highp float;
#endif

varying vec3 vNormal;
varying vec4 col;
varying vec3 poseye;
varying float posdist;

void main(void) {
  // Intensity of diffuse light
  float i = dot(poseye, vNormal);
  if (i < -1e-3)
    discard;
  vec4 cc = vec4(i * col.rgb, 1.);
//  i = max(min(i, 1.), 0.);

  // Diffuse light

  gl_FragColor = cc;
}
    </textarea>
    <script type="text/javascript" src="webglprotein.raw"></script>
    <script type="text/javascript">
function load_pdb(pdb_id) {
 var popup = document.getElementById("popup");
 popup.innerHTML = "Looking for protein <b>" + pdb_id + "</b>...";
 popup.style.display = "block";
 protgl.loadpdb(pdb_id,
  function() { popup.innerHTML = "Protein <b>" + pdb_id + "</b> found, displaying..."; },
  function() { popup.style.display = "none"; },
  function(xhr) { alert("Problem retrieving protein" + pdb_id); popup.style.display = "none"; });
}
    </script>
    <div id="protgl">
      <div id="input">
        <input id="pdb_input" title="PDB to load (ex. 2KXR):" size="6" value="2KXR" onkeyup="
if (event.keyCode == 13) {
  load_pdb(this.value);
}"/>
        <input type="submit" title="Load PDB from RSCB" value="Load PDB" onclick="
  var input = document.getElementById('pdb_input');
  load_pdb(input.value)"/>
      </div>
      <div id="commands">
       <div class="action" onclick="
var visible = protgl.getScene().getVisibility();
if (visible) {
  this.innerHTML = 'Show';
  protgl.show(false);
} else {
  this.innerHTML = 'Hide';
  protgl.show(true);
}">Hide</div>
<!--
       <div class="action" onclick="protgl.balls_sticks()">Balls &amp; Sticks</div>
       <div class="action" onclick="this.innerHTML='Baby'">Hey</div>
-->
      </div>
      <div id="popup">Popup</div>
      <canvas id='canvas-protgl' style="border: none;" width="500" height="500"></canvas>
      <script type="text/javascript"> var protgl = new WebGLProtein(); </script>
    </div>
  </body>
</html>

